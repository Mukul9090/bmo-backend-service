apiVersion: v1
kind: ConfigMap
metadata:
  name: haproxy-config
  namespace: default
data:
  haproxy.cfg: |
    global
      maxconn 2048
      log stdout format raw local0

    defaults
      mode http
      option httplog
      option log-health-checks
      timeout connect 5s
      timeout client  30s
      timeout server  30s
      timeout check   3s

    frontend http_front
      bind *:9090
      default_backend backend_pool

    backend backend_pool
      option httpchk GET /healthz
      http-check expect status 200
      
      # Hot cluster (primary) - active by default
      server hot backend-service.backend-hot.svc.cluster.local:80 check inter 2s fall 3 rise 2
      
      # Standby cluster (backup) - activates when hot fails
      server standby backend-service.backend-standby.svc.cluster.local:80 check inter 2s fall 3 rise 2 backup

