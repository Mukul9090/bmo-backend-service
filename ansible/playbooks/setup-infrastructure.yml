---
# Kubernetes Cluster Infrastructure Setup
# Production-ready playbook for configuring K8s cluster on Linux (Ubuntu/Debian)

- name: Setup Kubernetes Infrastructure
  hosts: k8s_clusters
  gather_facts: true
  become: true

  handlers:
    - name: restart sshd
      systemd:
        name: sshd
        state: restarted

  tasks:
    # ============================================================================
    # System Preparation
    # ============================================================================
    - name: Include system preparation tasks
      include_tasks: ../tasks/system-prep.yml

    # ============================================================================
    # Network Configuration
    # ============================================================================
    - name: Include network configuration tasks
      include_tasks: ../tasks/network-config.yml

    # ============================================================================
    # Docker Installation
    # ============================================================================
    - name: Include Docker installation tasks
      include_tasks: ../tasks/docker-install.yml

    # ============================================================================
    # Kubernetes Installation
    # ============================================================================
    - name: Include Kubernetes installation tasks
      include_tasks: ../tasks/kubernetes-install.yml

    # ============================================================================
    # Security Configuration
    # ============================================================================
    - name: Include security configuration tasks
      include_tasks: ../tasks/security.yml

    # ============================================================================
    # Vulnerability Scanning with OpenSCAP
    # ============================================================================
    - name: Include vulnerability scanning tasks
      include_tasks: ../tasks/vulnerability-scan.yml

    # ============================================================================
    # Kubernetes Cluster Initialization
    # ============================================================================
    - name: Include cluster initialization tasks
      include_tasks: ../tasks/cluster-init.yml
